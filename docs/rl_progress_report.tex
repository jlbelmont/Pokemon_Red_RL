\documentclass[12pt]{article}
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{siunitx}

\title{Bayesian Monitoring of Parcel Progress in Reinforcement Learning Agents}
\author{Jack Belmont \and Andrew Baggio}
\date{\today}

\begin{document}
\maketitle

\begin{abstract}
This update centers on the Bayesian posterior monitor that tracks parcel, badge, and exploration milestones for the Pokemon Red reinforcement learning agent. We summarise the present posterior beliefs (e.g., parcel success remains at $0.029$ while ``New Town'' saturates at $0.971$), interpret what those probabilities imply about policy behaviour, and outline the next experiments aimed at shifting those posteriors toward the project's goals.
\end{abstract}

\section{Overview}
Eight synchronized PyBoy environments feed a dueling distributional DQN. After each episode we record Bernoulli outcomes (parcel flags, badges, exploration quotas), update Beta posteriors inside \texttt{checkpoints/progress\_metrics.json}, and recompute plots/tables via \texttt{analysis/run\_pipeline.py} plus \texttt{analysis/reward\_success.py}. The current dashboard is lopsided: parcel success remains at $0.029$ (0/32 trials), while ``New Town Visited'' and combat thresholds sit at $0.971$ (32/32). The agent explores and wins battles but still fails the parcel quest, so every badge posterior stays at its Beta prior of 0.5.

\section{Posterior Pipeline}
\textbf{Training summary.} Headless runs on an M1 Max Mac use visit-count and episodic bonuses plus optional posterior-tuned RND scaling. Episodes last 12k steps, replay holds 4M transitions, and curriculum restarts alternate between fresh boots, parcel-prep, and battle-win savestates to guarantee parcel attempts remain in the buffer.

\textbf{Metrics captured.}
\begin{itemize}
  \item Beta($1,1$) milestone tracker for parcel, badge, combat, and exploration events (Table~\ref{tab:posterior-table}).
  \item Reward-success series parsed from ``Reward success probabilities'' log blocks (\texttt{artifacts/reward\_success\_timeseries.csv}).
  \item Curriculum audit (\texttt{curriculum\_events\_8env.csv}) to enforce a balance between parcel and battle savestates.
\end{itemize}

\section{Current Posteriors}
The tables below summarise the posterior means and 95\% credible intervals derived from the latest archive (\texttt{artifacts/runs/local\_20251130/progress\_metrics.json} plus \texttt{artifacts/reward\_success\_timeseries.csv}). Parcel-related entries show no movement, whereas combat/exploration metrics saturate.

\begin{table}[h]
  \centering
  \begin{tabular}{lrrrrr}
    \toprule
    Milestone & Step Limit & Succ./Trials & Mean & 95\% CI & Decision \\ \midrule
    Boulder Badge & 600{,}000 & 0/0 & 0.500 & [0.025, 0.975] & defer \\
    Cascade Badge & 800{,}000 & 0/0 & 0.500 & [0.026, 0.974] & defer \\
    Thunder Badge & 950{,}000 & 0/0 & 0.500 & [0.024, 0.976] & pursue \\
    Rainbow Badge & 1{,}100{,}000 & 0/0 & 0.500 & [0.024, 0.974] & pursue \\
    Soul Badge & 1{,}250{,}000 & 0/0 & 0.500 & [0.024, 0.975] & pursue \\
    Marsh Badge & 1{,}400{,}000 & 0/0 & 0.500 & [0.025, 0.975] & pursue \\
    Volcano Badge & 1{,}550{,}000 & 0/0 & 0.500 & [0.023, 0.975] & pursue \\
    Earth Badge & 1{,}650{,}000 & 0/0 & 0.500 & [0.025, 0.974] & pursue \\
    Champion & 1{,}800{,}000 & 0/0 & 0.500 & [0.024, 0.977] & pursue \\
    \bottomrule
  \end{tabular}
  \caption{Badge posteriors remain at their priors because parcel delivery has not occurred.}
  \label{tab:posterior-table}
\end{table}

\begin{table}[h]
  \centering
  \begin{tabular}{lcccc}
    \toprule
    Reward Target & Succ./Trials & Posterior Mean & 95\% CI & Step \\ \midrule
    Oak Parcel Assigned & 0/32 & 0.029 & [0.001, 0.105] & 384k \\
    New Town Visited    & 32/32 & 0.971 & [0.892, 0.999] & 384k \\
    Pokemon Defeated 1  & 6/32 & 0.206 & [0.091, 0.354] & 384k \\
    Episode Return $\ge 1500$ & 32/32 & 0.971 & [0.891, 0.999] & 384k \\
    Exploration Progress $\ge 120$ & 10/32 & 0.324 & [0.180, 0.487] & 384k \\
    Frontier Push $\ge 60$ & 32/32 & 0.971 & [0.896, 0.999] & 384k \\
    Visit Bonus $\ge 15$ & 6/32 & 0.206 & [0.090, 0.358] & 384k \\
    RND Bonus $\ge 20$ & 0/32 & 0.029 & [0.001, 0.104] & 384k \\
    \bottomrule
  \end{tabular}
  \caption{Reward-success posteriors show strong combat returns but zero parcel/RND achievements.}
\end{table}

\section{Interpretation and Next Steps}
The Bayesian dashboard tells a simple story: exploration is solved (posterior $0.971$), combat metrics are healthy, yet parcel delivery---the prerequisite for every badge---still has posterior mean $0.029$ with a wide interval. Until that value moves, all downstream badge alerts remain at 0.5. The immediate objective is therefore ``raise parcel posterior above 0.2,'' after which the optional posterior-driven RND scaling can taper intrinsic bonuses and refocus learning on Boulder Badge progress.

\textbf{Planned actions.}
\begin{itemize}
  \item Enable posterior-driven RND scaling (\texttt{analysis/rewards.py}) and rerun the 8-env curriculum with \texttt{posterior\_rnd\_enabled=true}.
  \item Add parcel-focused savestates (mart entry, Oak lab arrival) and guarantee at least two envs per run start from those checkpoints.
  \item Use \texttt{analysis/evaluation.py} to compute lead-time metrics so future parcel successes can trigger badge campaigns promptly.
  \item Capture per-step reward traces for a short evaluator episode to correlate posterior jumps with specific map transitions.
\end{itemize}

\end{document}
